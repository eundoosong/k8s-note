## IP 소켓 vs UNIX 도메인 소켓: 성능과 프로토콜 부하 비교

![image](https://github.com/user-attachments/assets/f36ee4a5-3b4a-4606-a1e4-5baff28f82f6)

서버 또는 데몬 프로그램을 작성할 때, IP 소켓과 UNIX 도메인 소켓 중 어떤 것을 사용할지 고민할 수 있습니다. 주요 선택 기준으로 성능과 프로토콜 부하가 있을 때, 
두 소켓 유형의 차이점을 비교해 보겠습니다.

- UNIX 도메인 소켓
  - 파일 시스템을 주소 네임스페이스로 사용합니다. 따라서 UNIX 파일 권한을 통해 접근 제어가 가능하며, 특정 프로세스만 소켓에 연결할 수 있도록 제한할 수 있습니다.
  - 성능: 동일한 시스템 내에서 동작한다는 점을 인식하여, 추가적인 네트워크 프로토콜 처리가 필요 없습니다. 송신 스레드는 데이터 스트림을 수신 소켓 버퍼에 직접 기록하며, 체크섬 계산, 헤더 삽입, 라우팅 등의 작업이 생략됩니다. 이로 인해 프로토콜 부하가 줄어듭니다.
  - 제한사항: TCP에서 제공하는 out-of-band 데이터 전송 기능은 지원하지 않습니다.

- IP 소켓
  - IP 주소를 사용하므로 네트워크 투명성을 제공합니다. 클라이언트 또는 서버를 다른 시스템으로 옮기더라도 IP 주소만 업데이트하면 바로 사용할 수 있습니다.
  - 성능: 루프백 인터페이스를 통해 ‘네트워크 상의’ IP 패킷을 전송하는 것과 동일하게 작동합니다. IP 스택을 통한 모든 프로세스를 그대로 따르므로 TCP 흐름 제어, 캡슐화/디캡슐화, ACK 전송 등의 작업이 수행됩니다. 이로 인해 성능 저하와 프로토콜 부하가 발생할 수 있습니다.
  - 이식성: TCP/IP를 사용하면 애플리케이션이 물리적 위치와 상관없이 동일하게 작동하므로 이식성이 뛰어납니다.

### 결론

로컬 성능이 가장 중요한 경우, UNIX 도메인 소켓이 적합합니다. 그러나 네트워크 투명성과 이식성이 필요한 경우, IP 소켓(TCP)을 사용하는 것이 더 나은 선택일 수 있습니다. 일반적으로 TCP를 사용하는 것이 더 많은 환경에서 활용 가능하지만, 로컬 통신의 성능이 중요하다면 UNIX 도메인 소켓을 고려해볼 만합니다.

이 글은 [Robert N M Watson의 분석](https://lists.freebsd.org/pipermail/freebsd-performance/2005-February/001143.html)을 기반으로 분석한 글입니다.
